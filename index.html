<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>F1 Telemetry Dashboard</title>

  <!-- MQTT Client -->
  <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>

  <style>
    body {
      background: #000;
      color: #0f0;
      font-family: monospace;
      padding: 20px;
    }
    .value-box {
      border: 1px solid #0f0;
      padding: 12px;
      margin: 6px 0;
      width: 250px;
      font-size: 18px;
    }
  </style>
</head>

<body>
  <h1>ðŸš€ F1 Telemetry Dashboard</h1>
  <p>Status: <span id="status">Connecting...</span></p>

  <!-- DISPLAY FIELDS -->
  <div class="value-box">Timestamp: <span id="ts">--</span></div>
  <div class="value-box">ADXL1 X: <span id="a1x">--</span></div>
  <div class="value-box">ADXL1 Y: <span id="a1y">--</span></div>
  <div class="value-box">ADXL1 Z: <span id="a1z">--</span></div>
  <div class="value-box">ADXL2 X: <span id="a2x">--</span></div>
  <div class="value-box">ADXL2 Y: <span id="a2y">--</span></div>
  <div class="value-box">ADXL2 Z: <span id="a2z">--</span></div>
  <div class="value-box">MPU Acc X: <span id="mAx">--</span></div>
  <div class="value-box">MPU Acc Y: <span id="mAy">--</span></div>
  <div class="value-box">MPU Acc Z: <span id="mAz">--</span></div>
  <div class="value-box">MPU Gyro X: <span id="mGx">--</span></div>
  <div class="value-box">MPU Gyro Y: <span id="mGy">--</span></div>
  <div class="value-box">MPU Gyro Z: <span id="mGz">--</span></div>

  <script>
    const TOPIC = "f1/telemetry";
    const clientId = "f1-dashboard-" + Math.random().toString(16).substr(2, 8);

    const client = mqtt.connect("wss://broker.hivemq.com:8884/mqtt", {
      clientId,
      clean: true,
      connectTimeout: 4000,
      reconnectPeriod: 2000,
    });

    const statusEl = document.getElementById("status");

    client.on("connect", () => {
      statusEl.textContent = "Connected âœ”ï¸";
      console.log("MQTT Connected:", clientId);

      client.subscribe(TOPIC, (err) => {
        if (err) console.error("Subscribe error", err);
        else console.log("Subscribed to", TOPIC);
      });
    });

    client.on("error", (err) => {
      statusEl.textContent = "Error âŒ (Check Console)";
      console.error("MQTT Error:", err);
    });

    client.on("message", (topic, payload) => {
      try {
        const d = JSON.parse(payload.toString());
        console.log("DATA:", d);

        document.getElementById("ts").textContent = d.timestamp;
        document.getElementById("a1x").textContent = d.adxl1_x.toFixed(3);
        document.getElementById("a1y").textContent = d.adxl1_y.toFixed(3);
        document.getElementById("a1z").textContent = d.adxl1_z.toFixed(3);
        document.getElementById("a2x").textContent = d.adxl2_x.toFixed(3);
        document.getElementById("a2y").textContent = d.adxl2_y.toFixed(3);
        document.getElementById("a2z").textContent = d.adxl2_z.toFixed(3);
        document.getElementById("mAx").textContent = d.mpu_acc_x.toFixed(3);
        document.getElementById("mAy").textContent = d.mpu_acc_y.toFixed(3);
        document.getElementById("mAz").textContent = d.mpu_acc_z.toFixed(3);
        document.getElementById("mGx").textContent = d.mpu_gyro_x.toFixed(3);
        document.getElementById("mGy").textContent = d.mpu_gyro_y.toFixed(3);
        document.getElementById("mGz").textContent = d.mpu_gyro_z.toFixed(3);

      } catch (e) {
        console.error("JSON Error:", e);
      }
    });
  </script>
</body>
</html>
